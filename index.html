<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Commercial Pro</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
        }

        h1 {
            color: white;
            font-size: 2.5rem;
            font-weight: 300;
        }

        .month-selector {
            display: flex;
            align-items: center;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 10px;
            backdrop-filter: blur(10px);
        }

        .month-btn {
            background: transparent;
            border: none;
            color: white;
            font-size: 24px;
            cursor: pointer;
            padding: 10px;
            border-radius: 8px;
            transition: all 0.3s;
        }

        .month-btn:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: scale(1.1);
        }

        .current-month {
            color: white;
            font-size: 18px;
            font-weight: 500;
            margin: 0 20px;
            min-width: 150px;
            text-align: center;
        }

        .tabs {
            display: flex;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 5px;
            margin-bottom: 30px;
            backdrop-filter: blur(10px);
        }

        .tab {
            flex: 1;
            padding: 15px;
            text-align: center;
            background: transparent;
            border: none;
            color: rgba(255, 255, 255, 0.7);
            cursor: pointer;
            border-radius: 10px;
            transition: all 0.3s;
            font-size: 16px;
        }

        .tab.active {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
            animation: fadeIn 0.3s ease-in;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .overview-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .overview-card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 25px;
            text-align: center;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
            position: relative;
            overflow: hidden;
        }

        .overview-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(45deg, #667eea, #764ba2);
        }

        .overview-card h3 {
            color: #4a5568;
            font-size: 14px;
            margin-bottom: 10px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .overview-card .value {
            font-size: 2rem;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .overview-card .trend {
            font-size: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 5px;
        }

        .cards-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
            transition: transform 0.3s;
        }

        .card:hover {
            transform: translateY(-5px);
        }

        .chart-container {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }

        .chart {
            display: flex;
            align-items: end;
            gap: 15px;
            height: 200px;
            padding: 20px 0;
        }

        .bar-group {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
        }

        .bar {
            width: 100%;
            max-width: 60px;
            background: linear-gradient(to top, #667eea, #764ba2);
            border-radius: 4px 4px 0 0;
            position: relative;
            transition: all 0.3s;
            cursor: pointer;
        }

        .bar:hover {
            transform: scaleY(1.05);
            box-shadow: 0 4px 20px rgba(102, 126, 234, 0.3);
        }

        .bar-value {
            position: absolute;
            top: -25px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 12px;
            font-weight: bold;
            color: #4a5568;
            white-space: nowrap;
        }

        .bar-label {
            font-size: 12px;
            color: #4a5568;
            text-align: center;
            font-weight: 500;
        }

        .metric {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid #e2e8f0;
        }

        .metric:last-child {
            border-bottom: none;
        }

        .metric-value {
            font-weight: bold;
            font-size: 1.1rem;
        }

        .positive { color: #38a169; }
        .negative { color: #e53e3e; }
        .neutral { color: #4a5568; }

        .progress-bar {
            width: 100%;
            height: 10px;
            background: #e2e8f0;
            border-radius: 5px;
            margin-top: 10px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            border-radius: 5px;
            transition: all 0.8s ease;
            background: linear-gradient(45deg, #38a169, #48bb78);
        }

        .input-group {
            margin-bottom: 20px;
        }

        .input-group label {
            display: block;
            margin-bottom: 8px;
            color: #4a5568;
            font-weight: 500;
        }

        .input-group input, .input-group select {
            width: 100%;
            padding: 14px;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            font-size: 16px;
            transition: border-color 0.3s;
        }

        .input-group input:focus, .input-group select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .btn {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 14px 28px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 500;
            margin: 5px;
            transition: all 0.3s;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
        }

        .btn-warning {
            background: linear-gradient(45deg, #ed8936, #dd6b20);
            box-shadow: 0 4px 15px rgba(237, 137, 54, 0.3);
        }

        .btn-secondary {
            background: linear-gradient(45deg, #718096, #4a5568);
            box-shadow: 0 4px 15px rgba(113, 128, 150, 0.3);
        }

        .alert {
            padding: 20px;
            border-radius: 10px;
            margin: 15px 0;
            border-left: 4px solid;
        }

        .alert-success {
            background: linear-gradient(45deg, #c6f6d5, #9ae6b4);
            color: #22543d;
            border-color: #38a169;
        }

        .alert-warning {
            background: linear-gradient(45deg, #fefcbf, #faf089);
            color: #744210;
            border-color: #ed8936;
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            background: linear-gradient(45deg, #38a169, #48bb78);
            color: white;
            border-radius: 10px;
            z-index: 1000;
            transform: translateX(400px);
            transition: transform 0.3s;
            box-shadow: 0 8px 25px rgba(56, 161, 105, 0.3);
        }

        .notification.show {
            transform: translateX(0);
        }

        .notification.warning {
            background: linear-gradient(45deg, #ed8936, #dd6b20);
            box-shadow: 0 8px 25px rgba(237, 137, 54, 0.3);
        }

        .comparison-section {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 30px;
        }

        .stats-card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }

        .evolution-indicator {
            display: inline-flex;
            align-items: center;
            gap: 5px;
            font-size: 14px;
            padding: 4px 8px;
            border-radius: 20px;
            font-weight: 500;
        }

        .evolution-up {
            background: #c6f6d5;
            color: #22543d;
        }

        .evolution-down {
            background: #fed7d7;
            color: #742a2a;
        }

        .evolution-equal {
            background: #e2e8f0;
            color: #4a5568;
        }

        @media (max-width: 768px) {
            .header {
                flex-direction: column;
                gap: 20px;
            }
            
            .comparison-section {
                grid-template-columns: 1fr;
            }
            
            .overview-grid {
                grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            }
            
            .cards-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üìä Dashboard Commercial Pro</h1>
            
            <div class="month-selector">
                <button class="month-btn" onclick="changerMois(-1)">‚Äπ</button>
                <span class="current-month" id="current-month"></span>
                <button class="month-btn" onclick="changerMois(1)">‚Ä∫</button>
            </div>
        </div>
        
        <div class="tabs">
            <button class="tab active" onclick="showTab('vue-ensemble')">üìà Vue d'ensemble</button>
            <button class="tab" onclick="showTab('vendeurs')">üë• Vendeurs</button>
            <button class="tab" onclick="showTab('vue-annuelle')">üóìÔ∏è Vue Annuelle</button>
            <button class="tab" onclick="showTab('comparatif')">üìä Comparatif</button>
            <button class="tab" onclick="showTab('saisie')">‚úèÔ∏è Saisie</button>
        </div>

        <!-- Vue d'ensemble -->
        <div id="vue-ensemble" class="tab-content active">
            <div class="overview-grid">
                <div class="overview-card">
                    <h3>Total Prospects</h3>
                    <div class="value neutral" id="total-prospects">0</div>
                    <div class="trend" id="trend-prospects"></div>
                </div>
                <div class="overview-card">
                    <h3>Total Ventes</h3>
                    <div class="value positive" id="total-ventes">0</div>
                    <div class="trend" id="trend-ventes"></div>
                </div>
                <div class="overview-card">
                    <h3>Taux Global</h3>
                    <div class="value" id="taux-global">0%</div>
                    <div class="trend" id="trend-taux"></div>
                </div>
                <div class="overview-card">
                    <h3>CA R√©alis√©</h3>
                    <div class="value positive" id="ca-realise">0 ‚Ç¨</div>
                    <div class="trend" id="trend-ca"></div>
                </div>
                <div class="overview-card">
                    <h3>Objectif Total</h3>
                    <div class="value neutral" id="objectif-total">0 ‚Ç¨</div>
                </div>
                <div class="overview-card">
                    <h3>Progression</h3>
                    <div class="value" id="progression-total">0%</div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="progress-ca" style="width: 0%"></div>
                    </div>
                </div>
            </div>

            <div class="chart-container">
                <h3 style="margin-bottom: 20px;">üìä CA par vendeur</h3>
                <div class="chart" id="chart-vendeurs"></div>
            </div>

            <div class="card">
                <h3>üèÜ Meilleur Vendeur du Mois</h3>
                <div class="metric">
                    <span>Nom</span>
                    <span class="metric-value positive" id="top-vendeur">-</span>
                </div>
                <div class="metric">
                    <span>CA</span>
                    <span class="metric-value positive" id="top-ca">0 ‚Ç¨</span>
                </div>
                <div class="metric">
                    <span>Taux de conversion</span>
                    <span class="metric-value positive" id="top-taux">0%</span>
                </div>
                <div class="metric">
                    <span>Progression objectif</span>
                    <span class="metric-value positive" id="top-progression">0%</span>
                </div>
            </div>

            <div id="alertes-marges"></div>
        </div>

        <!-- Vendeurs -->
        <div id="vendeurs" class="tab-content">
            <div class="cards-grid" id="vendeurs-grid"></div>
        </div>

        <!-- Vue Annuelle -->
        <div id="vue-annuelle" class="tab-content">
            <div class="overview-grid">
                <div class="overview-card">
                    <h3>CA Annuel</h3>
                    <div class="value positive" id="ca-annuel">0 ‚Ç¨</div>
                    <div class="trend" id="trend-ca-annuel"></div>
                </div>
                <div class="overview-card">
                    <h3>Objectif Annuel</h3>
                    <div class="value neutral" id="objectif-annuel">0 ‚Ç¨</div>
                </div>
                <div class="overview-card">
                    <h3>Progression</h3>
                    <div class="value" id="progression-annuelle">0%</div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="progress-annuel" style="width: 0%"></div>
                    </div>
                </div>
                <div class="overview-card">
                    <h3>Ventes Totales</h3>
                    <div class="value positive" id="ventes-annuelles">0</div>
                </div>
                <div class="overview-card">
                    <h3>Prospects Totaux</h3>
                    <div class="value neutral" id="prospects-annuels">0</div>
                </div>
                <div class="overview-card">
                    <h3>Taux Global Annuel</h3>
                    <div class="value" id="taux-annuel">0%</div>
                </div>
            </div>

            <div class="chart-container">
                <h3 style="margin-bottom: 20px;">üìà √âvolution mensuelle du CA ${anneeActuelle}</h3>
                <div class="chart" id="chart-annuel" style="height: 250px;"></div>
            </div>

            <div class="comparison-section">
                <div class="stats-card">
                    <h3>üèÜ Classement annuel des vendeurs</h3>
                    <div id="classement-annuel"></div>
                </div>
                <div class="stats-card">
                    <h3>üìä Statistiques par trimestre</h3>
                    <div id="stats-trimestrielles"></div>
                </div>
            </div>

            <div class="cards-grid">
                <div class="card">
                    <h3>üéØ Performance annuelle par vendeur</h3>
                    <div id="performance-annuelle"></div>
                </div>
                <div class="card">
                    <h3>üìà Meilleur/Pire mois de l'ann√©e</h3>
                    <div id="analyse-mois"></div>
                </div>
            </div>

            <div class="chart-container">
                <h3 style="margin-bottom: 20px;">üìä R√©partition du CA par vendeur (${anneeActuelle})</h3>
                <div style="display: flex; justify-content: center; align-items: center; height: 200px;">
                    <canvas id="chart-repartition" width="300" height="300"></canvas>
                </div>
            </div>
        </div>

        <!-- Comparatif -->
        <div id="comparatif" class="tab-content">
            <div class="comparison-section">
                <div class="stats-card">
                    <h3>üìà √âvolution par rapport au mois pr√©c√©dent</h3>
                    <div id="evolution-content"></div>
                </div>
                <div class="stats-card">
                    <h3>üéØ Performance vs Objectifs</h3>
                    <div id="performance-content"></div>
                </div>
            </div>
            
            <div class="chart-container">
                <h3 style="margin-bottom: 20px;">üìä √âvolution du CA sur 6 mois</h3>
                <div class="chart" id="chart-evolution"></div>
            </div>
        </div>

        <!-- Saisie -->
        <div id="saisie" class="tab-content">
            <div class="cards-grid">
                <div class="card">
                    <h3>üìù Saisie des donn√©es</h3>
                    
                    <div class="input-group">
                        <label for="vendeur-select">Vendeur</label>
                        <select id="vendeur-select">
                            <option value="Vincent">Vincent</option>
                            <option value="Raphael">Raphael</option>
                            <option value="L√©o">L√©o</option>
                            <option value="Pablo">Pablo</option>
                            <option value="Nathan">Nathan</option>
                        </select>
                    </div>

                    <div class="input-group">
                        <label for="prospects-input">Prospects</label>
                        <input type="number" id="prospects-input" placeholder="Nombre de prospects">
                    </div>

                    <div class="input-group">
                        <label for="ventes-input">Ventes</label>
                        <input type="number" id="ventes-input" placeholder="Nombre de ventes">
                    </div>

                    <div class="input-group">
                        <label for="ca-input">CA (‚Ç¨)</label>
                        <input type="number" id="ca-input" placeholder="Chiffre d'affaires">
                    </div>

                    <button class="btn" onclick="sauvegarderDonnees()">üíæ Sauvegarder</button>
                </div>

                <div class="card">
                    <h3>‚öôÔ∏è Administration</h3>
                    
                    <button class="btn btn-secondary" onclick="exporterDonnees()">üì• Exporter donn√©es</button>
                    <button class="btn btn-warning" onclick="reinitialiserMois()">üîÑ R√©initialiser mois</button>
                    <button class="btn btn-warning" onclick="reinitialiserTout()">üóëÔ∏è Tout effacer</button>
                    
                    <div style="margin-top: 20px; padding: 15px; background: #f7fafc; border-radius: 8px;">
                        <h4 style="margin-bottom: 10px;">üìã Actions rapides :</h4>
                        <button class="btn btn-secondary" onclick="genererDonneesDemonstration()">üé≠ Donn√©es d√©mo</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Configuration initiale
        const MOIS_NOMS = [
            'Janvier', 'F√©vrier', 'Mars', 'Avril', 'Mai', 'Juin',
            'Juillet', 'Ao√ªt', 'Septembre', 'Octobre', 'Novembre', 'D√©cembre'
        ];

        let moisActuel = new Date().getMonth();
        let anneeActuelle = new Date().getFullYear();

        // Structure des donn√©es par mois
        let donneesParMois = {};

        // Initialisation des donn√©es vides pour tous les mois
        function initialiserDonnees() {
            for (let mois = 0; mois < 12; mois++) {
                const key = `${anneeActuelle}-${mois}`;
                if (!donneesParMois[key]) {
                    donneesParMois[key] = {
                        'Vincent': { prospects: 0, ventes: 0, ca: 0, objectif: 80000 },
                        'Raphael': { prospects: 0, ventes: 0, ca: 0, objectif: 100000 },
                        'L√©o': { prospects: 0, ventes: 0, ca: 0, objectif: 75000 },
                        'Pablo': { prospects: 0, ventes: 0, ca: 0, objectif: 90000 },
                        'Nathan': { prospects: 0, ventes: 0, ca: 0, objectif: 85000 }
                    };
                }
            }
        }

        function getMoisKey(mois = moisActuel, annee = anneeActuelle) {
            return `${annee}-${mois}`;
        }

        function getDonneesActuelles() {
            return donneesParMois[getMoisKey()];
        }

        // Navigation entre les mois
        function changerMois(direction) {
            moisActuel += direction;
            
            if (moisActuel < 0) {
                moisActuel = 11;
                anneeActuelle--;
            } else if (moisActuel > 11) {
                moisActuel = 0;
                anneeActuelle++;
            }
            
            // S'assurer que les donn√©es existent pour le nouveau mois
            const key = getMoisKey();
            if (!donneesParMois[key]) {
                donneesParMois[key] = {
                    'Vincent': { prospects: 0, ventes: 0, ca: 0, objectif: 80000 },
                    'Raphael': { prospects: 0, ventes: 0, ca: 0, objectif: 100000 },
                    'L√©o': { prospects: 0, ventes: 0, ca: 0, objectif: 75000 },
                    'Pablo': { prospects: 0, ventes: 0, ca: 0, objectif: 90000 },
                    'Nathan': { prospects: 0, ventes: 0, ca: 0, objectif: 85000 }
                };
            }
            
            updateMoisAffichage();
            
            // Mettre √† jour l'onglet actif
            const activeTab = document.querySelector('.tab.active');
            if (activeTab) {
                const tabName = activeTab.textContent.includes('ensemble') ? 'vue-ensemble' :
                               activeTab.textContent.includes('Vendeurs') ? 'vendeurs' :
                               activeTab.textContent.includes('Annuelle') ? 'vue-annuelle' :
                               activeTab.textContent.includes('Comparatif') ? 'comparatif' : 'saisie';
                               
                updateTabContent(tabName);
            }
        }

        function updateMoisAffichage() {
            document.getElementById('current-month').textContent = 
                `${MOIS_NOMS[moisActuel]} ${anneeActuelle}`;
        }

        // Navigation entre onglets
        function showTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');
            
            updateTabContent(tabName);
        }

        function updateTabContent(tabName) {
            switch(tabName) {
                case 'vue-ensemble':
                    updateVueEnsemble();
                    break;
                case 'vendeurs':
                    updateVendeurs();
                    break;
                case 'vue-annuelle':
                    updateVueAnnuelle();
                    break;
                case 'comparatif':
                    updateComparatif();
                    break;
            }
        }

        // Calcul des tendances
        function calculerTendance(valeurActuelle, valeurPrecedente) {
            if (valeurPrecedente === 0) return { type: 'equal', text: 'Nouveau' };
            
            const evolution = ((valeurActuelle - valeurPrecedente) / valeurPrecedente) * 100;
            
            if (evolution > 0) {
                return { type: 'up', text: `+${evolution.toFixed(1)}%` };
            } else if (evolution < 0) {
                return { type: 'down', text: `${evolution.toFixed(1)}%` };
            } else {
                return { type: 'equal', text: '0%' };
            }
        }

        function afficherTendance(elementId, valeurActuelle, valeurPrecedente) {
            const element = document.getElementById(elementId);
            const tendance = calculerTendance(valeurActuelle, valeurPrecedente);
            
            element.innerHTML = `
                <span class="evolution-indicator evolution-${tendance.type}">
                    ${tendance.type === 'up' ? '‚Üó' : tendance.type === 'down' ? '‚Üò' : '‚Üí'} ${tendance.text}
                </span>
            `;
        }

        // Mise √† jour de la vue d'ensemble
        function updateVueEnsemble() {
            const donneesActuelles = getDonneesActuelles();
            const moisPrecedent = moisActuel === 0 ? 11 : moisActuel - 1;
            const anneePrecedente = moisActuel === 0 ? anneeActuelle - 1 : anneeActuelle;
            const donneesPrecedentes = donneesParMois[`${anneePrecedente}-${moisPrecedent}`] || {};
            
            let totalProspects = 0, totalVentes = 0, totalCA = 0, totalObjectif = 0;
            let prevProspects = 0, prevVentes = 0, prevCA = 0;
            let bestVendeur = '', bestCA = 0, bestTaux = 0, bestProgression = 0;

            // Calculs pour le mois actuel
            for (let vendeur in donneesActuelles) {
                const data = donneesActuelles[vendeur];
                totalProspects += data.prospects;
                totalVentes += data.ventes;
                totalCA += data.ca;
                totalObjectif += data.objectif;

                const taux = data.prospects > 0 ? (data.ventes / data.prospects * 100) : 0;
                const progression = data.objectif > 0 ? (data.ca / data.objectif * 100) : 0;
                
                if (data.ca > bestCA) {
                    bestCA = data.ca;
                    bestVendeur = vendeur;
                    bestTaux = taux;
                    bestProgression = progression;
                }
            }

            // Calculs pour le mois pr√©c√©dent
            for (let vendeur in donneesPrecedentes) {
                const data = donneesPrecedentes[vendeur] || { prospects: 0, ventes: 0, ca: 0 };
                prevProspects += data.prospects;
                prevVentes += data.ventes;
                prevCA += data.ca;
            }

            const tauxGlobal = totalProspects > 0 ? (totalVentes / totalProspects * 100) : 0;
            const progressionCA = totalObjectif > 0 ? (totalCA / totalObjectif * 100) : 0;
            const prevTaux = prevProspects > 0 ? (prevVentes / prevProspects * 100) : 0;

            // Mise √† jour des valeurs
            document.getElementById('total-prospects').textContent = totalProspects;
            document.getElementById('total-ventes').textContent = totalVentes;
            document.getElementById('taux-global').textContent = tauxGlobal.toFixed(1) + '%';
            document.getElementById('taux-global').className = 'value ' + (tauxGlobal >= 20 ? 'positive' : 'neutral');
            
            document.getElementById('ca-realise').textContent = totalCA.toLocaleString() + ' ‚Ç¨';
            document.getElementById('objectif-total').textContent = totalObjectif.toLocaleString() + ' ‚Ç¨';
            document.getElementById('progression-total').textContent = progressionCA.toFixed(1) + '%';
            document.getElementById('progression-total').className = 'value ' + (progressionCA >= 100 ? 'positive' : 'neutral');
            document.getElementById('progress-ca').style.width = Math.min(100, progressionCA) + '%';

            document.getElementById('top-vendeur').textContent = bestVendeur || '-';
            document.getElementById('top-ca').textContent = bestCA.toLocaleString() + ' ‚Ç¨';
            document.getElementById('top-taux').textContent = bestTaux.toFixed(1) + '%';
            document.getElementById('top-progression').textContent = bestProgression.toFixed(1) + '%';

            // Affichage des tendances
            afficherTendance('trend-prospects', totalProspects, prevProspects);
            afficherTendance('trend-ventes', totalVentes, prevVentes);
            afficherTendance('trend-taux', tauxGlobal, prevTaux);
            afficherTendance('trend-ca', totalCA, prevCA);

            updateChart();
            updateAlertes();
        }

        // Mise √† jour du graphique
        function updateChart() {
            const chart = document.getElementById('chart-vendeurs');
            const donneesActuelles = getDonneesActuelles();
            const vendeurs = Object.keys(donneesActuelles);
            
            let html = '';
            const maxCA = Math.max(...vendeurs.map(v => donneesActuelles[v].ca));
            
            vendeurs.forEach(vendeur => {
                const data = donneesActuelles[vendeur];
                const height = maxCA > 0 ? Math.max(30, (data.ca / maxCA) * 160) : 30;
                
                html += `
                    <div class="bar-group">
                        <div class="bar" style="height: ${height}px;">
                            <div class="bar-value">${(data.ca/1000).toFixed(0)}k‚Ç¨</div>
                        </div>
                        <div class="bar-label">${vendeur}</div>
                    </div>
                `;
            });
            
            chart.innerHTML = html;
        }

        // Mise √† jour des alertes
        function updateAlertes() {
            const container = document.getElementById('alertes-marges');
            const donneesActuelles = getDonneesActuelles();
            let alertes = [];

            for (let vendeur in donneesActuelles) {
                const data = donneesActuelles[vendeur];
                const progression = data.objectif > 0 ? (data.ca / data.objectif * 100) : 0;
                
                if (progression < 50) {
                    alertes.push(`${vendeur} : ${progression.toFixed(1)}% de son objectif`);
                }
            }

            if (alertes.length === 0) {
                container.innerHTML = `
                    <div class="alert alert-success">
                        <strong>‚úÖ Excellent !</strong> Tous les vendeurs progressent bien vers leurs objectifs.
                    </div>
                `;
            } else {
                container.innerHTML = `
                    <div class="alert alert-warning">
                        <strong>‚ö†Ô∏è ${alertes.length} vendeur(s) en retard sur objectifs :</strong><br>
                        ${alertes.join('<br>')}
                    </div>
                `;
            }
        }

        // Mise √† jour des vendeurs
        function updateVendeurs() {
            const grid = document.getElementById('vendeurs-grid');
            const donneesActuelles = getDonneesActuelles();
            grid.innerHTML = '';

            for (let vendeur in donneesActuelles) {
                const data = donneesActuelles[vendeur];
                const taux = data.prospects > 0 ? (data.ventes / data.prospects * 100) : 0;
                const progression = data.objectif > 0 ? (data.ca / data.objectif * 100) : 0;
                const ecart = data.ca - data.objectif;

                const card = document.createElement('div');
                card.className = 'card';
                card.innerHTML = `
                    <h3>üë§ ${vendeur}</h3>
                    <div class="metric">
                        <span>Prospects</span>
                        <span class="metric-value neutral">${data.prospects}</span>
                    </div>
                    <div class="metric">
                        <span>Ventes</span>
                        <span class="metric-value positive">${data.ventes}</span>
                    </div>
                    <div class="metric">
                        <span>CA</span>
                        <span class="metric-value positive">${data.ca.toLocaleString()} ‚Ç¨</span>
                    </div>
                    <div class="metric">
                        <span>Objectif</span>
                        <span class="metric-value neutral">${data.objectif.toLocaleString()} ‚Ç¨</span>
                    </div>
                    <div class="metric">
                        <span>√âcart objectif</span>
                        <span class="metric-value ${ecart >= 0 ? 'positive' : 'negative'}">${ecart >= 0 ? '+' : ''}${ecart.toLocaleString()} ‚Ç¨</span>
                    </div>
                    <div class="metric">
                        <span>Taux conversion</span>
                        <span class="metric-value ${taux >= 25 ? 'positive' : 'neutral'}">${taux.toFixed(1)}%</span>
                    </div>
                    <div class="metric">
                        <span>Progression</span>
                        <span class="metric-value ${progression >= 100 ? 'positive' : 'neutral'}">${progression.toFixed(1)}%</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: ${Math.min(100, progression)}%"></div>
                    </div>
                    ${progression < 50 ? `
                        <div class="alert alert-warning" style="margin-top: 15px;">
                            <strong>‚ö†Ô∏è Attention :</strong> Progression faible (${progression.toFixed(1)}%)
                        </div>
                    ` : ''}
                `;
                grid.appendChild(card);
            }
        }

        // Mise √† jour du comparatif
        function updateComparatif() {
            updateEvolution();
            updatePerformance();
            updateChartEvolution();
        }

        function updateEvolution() {
            const container = document.getElementById('evolution-content');
            const donneesActuelles = getDonneesActuelles();
            const moisPrecedent = moisActuel === 0 ? 11 : moisActuel - 1;
            const anneePrecedente = moisActuel === 0 ? anneeActuelle - 1 : anneeActuelle;
            const donneesPrecedentes = donneesParMois[`${anneePrecedente}-${moisPrecedent}`] || {};

            let html = '';
            let totalCA = 0, prevCA = 0, totalVentes = 0, prevVentes = 0;

            // Calculs globaux
            for (let vendeur in donneesActuelles) {
                totalCA += donneesActuelles[vendeur].ca;
                totalVentes += donneesActuelles[vendeur].ventes;
            }
            for (let vendeur in donneesPrecedentes) {
                prevCA += donneesPrecedentes[vendeur]?.ca || 0;
                prevVentes += donneesPrecedentes[vendeur]?.ventes || 0;
            }

            const evolutionCA = calculerTendance(totalCA, prevCA);
            const evolutionVentes = calculerTendance(totalVentes, prevVentes);

            html += `
                <div class="metric">
                    <span>CA Total</span>
                    <span class="evolution-indicator evolution-${evolutionCA.type}">
                        ${evolutionCA.type === 'up' ? '‚Üó' : evolutionCA.type === 'down' ? '‚Üò' : '‚Üí'} ${evolutionCA.text}
                    </span>
                </div>
                <div class="metric">
                    <span>Ventes Totales</span>
                    <span class="evolution-indicator evolution-${evolutionVentes.type}">
                        ${evolutionVentes.type === 'up' ? '‚Üó' : evolutionVentes.type === 'down' ? '‚Üò' : '‚Üí'} ${evolutionVentes.text}
                    </span>
                </div>
                <hr style="margin: 15px 0;">
            `;

            // √âvolution par vendeur
            for (let vendeur in donneesActuelles) {
                const actuel = donneesActuelles[vendeur].ca;
                const precedent = donneesPrecedentes[vendeur]?.ca || 0;
                const evolution = calculerTendance(actuel, precedent);

                html += `
                    <div class="metric">
                        <span>${vendeur}</span>
                        <span class="evolution-indicator evolution-${evolution.type}">
                            ${evolution.type === 'up' ? '‚Üó' : evolution.type === 'down' ? '‚Üò' : '‚Üí'} ${evolution.text}
                        </span>
                    </div>
                `;
            }

            container.innerHTML = html;
        }

        function updatePerformance() {
            const container = document.getElementById('performance-content');
            const donneesActuelles = getDonneesActuelles();
            let html = '';

            for (let vendeur in donneesActuelles) {
                const data = donneesActuelles[vendeur];
                const progression = data.objectif > 0 ? (data.ca / data.objectif * 100) : 0;
                const status = progression >= 100 ? 'positive' : progression >= 75 ? 'neutral' : 'negative';
                const icon = progression >= 100 ? 'üéØ' : progression >= 75 ? 'üìà' : '‚ö†Ô∏è';

                html += `
                    <div class="metric">
                        <span>${icon} ${vendeur}</span>
                        <span class="metric-value ${status}">${progression.toFixed(1)}%</span>
                    </div>
                `;
            }

            container.innerHTML = html;
        }

        function updateChartEvolution() {
            const chart = document.getElementById('chart-evolution');
            let html = '';
            
            // R√©cup√©rer les 6 derniers mois
            const moisData = [];
            for (let i = 5; i >= 0; i--) {
                let mois = moisActuel - i;
                let annee = anneeActuelle;
                
                if (mois < 0) {
                    mois += 12;
                    annee--;
                }
                
                const key = `${annee}-${mois}`;
                const donnees = donneesParMois[key] || {};
                let totalCA = 0;
                
                for (let vendeur in donnees) {
                    totalCA += donnees[vendeur]?.ca || 0;
                }
                
                moisData.push({
                    mois: MOIS_NOMS[mois].substring(0, 3),
                    ca: totalCA,
                    isActuel: mois === moisActuel && annee === anneeActuelle
                });
            }
            
            const maxCA = Math.max(...moisData.map(m => m.ca));
            
            moisData.forEach(({mois, ca, isActuel}) => {
                const height = maxCA > 0 ? Math.max(30, (ca / maxCA) * 160) : 30;
                
                html += `
                    <div class="bar-group">
                        <div class="bar" style="
                            height: ${height}px; 
                            background: ${isActuel ? 'linear-gradient(to top, #667eea, #764ba2)' : 'linear-gradient(to top, #48bb78, #38a169)'};
                            ${isActuel ? 'box-shadow: 0 4px 20px rgba(102, 126, 234, 0.4);' : ''}
                        ">
                            <div class="bar-value">${(ca/1000).toFixed(0)}k‚Ç¨</div>
                        </div>
                        <div class="bar-label" style="font-weight: ${isActuel ? 'bold' : 'normal'};">${mois}</div>
                    </div>
                `;
            });
            
            chart.innerHTML = html;
        }

        // Notification
        function showNotification(message, type = 'success') {
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.textContent = message;
            document.body.appendChild(notification);
            
            setTimeout(() => notification.classList.add('show'), 100);
            setTimeout(() => {
                notification.classList.remove('show');
                setTimeout(() => document.body.removeChild(notification), 300);
            }, 3000);
        }

        // Sauvegarde des donn√©es
        function sauvegarderDonnees() {
            const vendeur = document.getElementById('vendeur-select').value;
            const prospects = parseInt(document.getElementById('prospects-input').value) || 0;
            const ventes = parseInt(document.getElementById('ventes-input').value) || 0;
            const ca = parseInt(document.getElementById('ca-input').value) || 0;

            if (prospects === 0 && ventes === 0 && ca === 0) {
                showNotification('Veuillez saisir au moins une valeur', 'warning');
                return;
            }

            if (ventes > prospects && prospects > 0) {
                showNotification('Erreur : les ventes ne peuvent pas d√©passer les prospects', 'warning');
                return;
            }

            // Mise √† jour des donn√©es du mois actuel
            const donneesActuelles = getDonneesActuelles();
            donneesActuelles[vendeur].prospects += prospects;
            donneesActuelles[vendeur].ventes += ventes;
            donneesActuelles[vendeur].ca += ca;

            // R√©initialiser le formulaire
            document.getElementById('prospects-input').value = '';
            document.getElementById('ventes-input').value = '';
            document.getElementById('ca-input').value = '';

            showNotification(`Donn√©es sauvegard√©es pour ${vendeur} (${MOIS_NOMS[moisActuel]})`);
            
            // Mettre √† jour l'affichage selon l'onglet actif
            const activeTab = document.querySelector('.tab.active');
            if (activeTab) {
                const tabName = activeTab.textContent.includes('ensemble') ? 'vue-ensemble' :
                               activeTab.textContent.includes('Vendeurs') ? 'vendeurs' :
                               activeTab.textContent.includes('Annuelle') ? 'vue-annuelle' :
                               activeTab.textContent.includes('Comparatif') ? 'comparatif' : 'saisie';
                updateTabContent(tabName);
            }
        }

        // Export des donn√©es
        function exporterDonnees() {
            const dataToExport = {
                donneesParMois: donneesParMois,
                moisActuel: moisActuel,
                anneeActuelle: anneeActuelle,
                dateExport: new Date().toISOString(),
                version: "2.0"
            };
            
            const blob = new Blob([JSON.stringify(dataToExport, null, 2)], {type: 'application/json'});
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `dashboard-commercial-${anneeActuelle}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showNotification('Donn√©es export√©es avec succ√®s !');
        }

        // R√©initialisations
        function reinitialiserMois() {
            if (confirm(`√ätes-vous s√ªr de vouloir r√©initialiser les donn√©es de ${MOIS_NOMS[moisActuel]} ${anneeActuelle} ?`)) {
                const key = getMoisKey();
                donneesParMois[key] = {
                    'Vincent': { prospects: 0, ventes: 0, ca: 0, objectif: 80000 },
                    'Raphael': { prospects: 0, ventes: 0, ca: 0, objectif: 100000 },
                    'L√©o': { prospects: 0, ventes: 0, ca: 0, objectif: 75000 },
                    'Pablo': { prospects: 0, ventes: 0, ca: 0, objectif: 90000 },
                    'Nathan': { prospects: 0, ventes: 0, ca: 0, objectif: 85000 }
                };
                
                updateTabContent('vue-ensemble');
                showNotification(`Donn√©es de ${MOIS_NOMS[moisActuel]} r√©initialis√©es`, 'warning');
            }
        }

        function reinitialiserTout() {
            if (confirm('‚ö†Ô∏è ATTENTION : Cette action supprimera TOUTES les donn√©es de TOUS les mois. √ätes-vous absolument certain ?')) {
                donneesParMois = {};
                initialiserDonnees();
                updateTabContent('vue-ensemble');
                showNotification('Toutes les donn√©es ont √©t√© supprim√©es', 'warning');
            }
        }

        // G√©n√©ration de donn√©es de d√©monstration
        function genererDonneesDemonstration() {
            if (confirm('G√©n√©rer des donn√©es de d√©monstration pour les 6 derniers mois ?')) {
                for (let i = 5; i >= 0; i--) {
                    let mois = moisActuel - i;
                    let annee = anneeActuelle;
                    
                    if (mois < 0) {
                        mois += 12;
                        annee--;
                    }
                    
                    const key = `${annee}-${mois}`;
                    const facteur = 0.7 + Math.random() * 0.6; // Variation r√©aliste
                    
                    donneesParMois[key] = {
                        'Vincent': { 
                            prospects: Math.floor(50 * facteur), 
                            ventes: Math.floor(12 * facteur), 
                            ca: Math.floor(45000 * facteur), 
                            objectif: 80000 
                        },
                        'Raphael': { 
                            prospects: Math.floor(60 * facteur), 
                            ventes: Math.floor(18 * facteur), 
                            ca: Math.floor(75000 * facteur), 
                            objectif: 100000 
                        },
                        'L√©o': { 
                            prospects: Math.floor(45 * facteur), 
                            ventes: Math.floor(10 * facteur), 
                            ca: Math.floor(35000 * facteur), 
                            objectif: 75000 
                        },
                        'Pablo': { 
                            prospects: Math.floor(55 * facteur), 
                            ventes: Math.floor(15 * facteur), 
                            ca: Math.floor(60000 * facteur), 
                            objectif: 90000 
                        },
                        'Nathan': { 
                            prospects: Math.floor(48 * facteur), 
                            ventes: Math.floor(13 * facteur), 
                            ca: Math.floor(52000 * facteur), 
                            objectif: 85000 
                        }
                    };
                }
                
                updateTabContent('vue-ensemble');
                showNotification('Donn√©es de d√©monstration g√©n√©r√©es !');
            }
        }

        // Initialisation au chargement
        document.addEventListener('DOMContentLoaded', function() {
            initialiserDonnees();
            updateMoisAffichage();
            updateVueEnsemble();
            showNotification('Dashboard Pro charg√© ! üöÄ');
        });
    </script>
</body>
</html>
