<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Commercial - Po√™les & Granul√©s</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
        }

        .header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            text-align: center;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }

        .header h1 {
            color: #2d3748;
            font-size: 2.5em;
            margin-bottom: 10px;
            background: linear-gradient(45deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .tabs {
            display: flex;
            background: rgba(255, 255, 255, 0.9);
            border-radius: 10px;
            padding: 5px;
            margin-bottom: 20px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            flex-wrap: wrap;
        }

        .tab {
            flex: 1;
            min-width: 120px;
            padding: 12px 15px;
            border: none;
            background: transparent;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            color: #4a5568;
            text-align: center;
        }

        .tab.active {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            overflow: hidden;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.15);
        }

        .card h3 {
            color: #2d3748;
            margin-bottom: 15px;
            font-size: 1.3em;
        }

        .metric {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid #e2e8f0;
        }

        .metric:last-child {
            border-bottom: none;
        }

        .metric-value {
            font-weight: bold;
            font-size: 1.2em;
        }

        .positive { color: #38a169; }
        .negative { color: #e53e3e; }
        .neutral { color: #3182ce; }

        .progress-bar {
            width: 100%;
            height: 10px;
            background: #e2e8f0;
            border-radius: 5px;
            margin: 10px 0;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(45deg, #48bb78, #38a169);
            transition: width 0.3s ease;
        }

        .vendeur-card {
            border-left: 4px solid #667eea;
        }

        .input-group {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .input-field {
            display: flex;
            flex-direction: column;
        }

        .input-field label {
            margin-bottom: 5px;
            font-weight: 600;
            color: #4a5568;
        }

        .input-field input, .input-field select {
            padding: 10px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 1em;
            transition: border-color 0.3s ease;
        }

        .input-field input:focus, .input-field select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .btn {
            padding: 12px 24px;
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            margin: 5px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
        }

        .btn-danger {
            background: linear-gradient(45deg, #e53e3e, #c53030);
        }

        .chart-container {
            height: 300px;
            display: flex;
            align-items: end;
            justify-content: space-around;
            background: #f7fafc;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            overflow-x: auto;
        }

        .bar-group {
            display: flex;
            flex-direction: column;
            align-items: center;
            min-width: 80px;
            margin: 0 5px;
        }

        .bar {
            background: linear-gradient(to top, #667eea, #764ba2);
            border-radius: 4px 4px 0 0;
            min-height: 20px;
            width: 40px;
            position: relative;
            transition: height 0.5s ease;
        }

        .bar-label {
            margin-top: 10px;
            font-size: 0.8em;
            font-weight: 600;
            color: #4a5568;
            text-align: center;
            max-width: 60px;
            word-wrap: break-word;
        }

        .bar-value {
            position: absolute;
            top: -25px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 0.8em;
            font-weight: bold;
            color: #2d3748;
            white-space: nowrap;
        }

        .alert {
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
            font-weight: 600;
        }

        .alert-success {
            background: rgba(72, 187, 120, 0.1);
            border: 1px solid #48bb78;
            color: #2f855a;
        }

        .alert-warning {
            background: rgba(237, 137, 54, 0.1);
            border: 1px solid #ed8936;
            color: #c05621;
        }

        .alert-info {
            background: rgba(66, 153, 225, 0.1);
            border: 1px solid #4299e1;
            color: #2b6cb0;
        }

        .paliers-container {
            background: #f7fafc;
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
        }

        .palier-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid #e2e8f0;
        }

        .palier-item:last-child {
            border-bottom: none;
        }

        .prime-badge {
            background: linear-gradient(45deg, #48bb78, #38a169);
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.9em;
            font-weight: bold;
        }

        .prediction-card {
            background: linear-gradient(135deg, #4299e1, #3182ce);
            color: white;
        }

        .prediction-card h3 {
            color: white;
        }

        .ai-indicator {
            display: inline-block;
            background: rgba(255, 255, 255, 0.2);
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.8em;
            margin-left: 8px;
        }

        @media (max-width: 768px) {
            .dashboard-grid {
                grid-template-columns: 1fr;
            }
            
            .tabs {
                flex-direction: column;
            }
            
            .header h1 {
                font-size: 2em;
            }

            .chart-container {
                height: 250px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üî• Dashboard Commercial - Po√™les & Granul√©s</h1>
            <p>Suivi des performances de votre √©quipe de vente</p>
        </div>

        <div class="tabs">
            <button class="tab active" onclick="showTab('vue-ensemble')">Vue d'ensemble</button>
            <button class="tab" onclick="showTab('vendeurs')">Vendeurs</button>
            <button class="tab" onclick="showTab('objectifs')">Objectifs & Primes</button>
            <button class="tab" onclick="showTab('predictions')">Pr√©dictions IA</button>
            <button class="tab" onclick="showTab('tunnel')">Tunnel conversion</button>
            <button class="tab" onclick="showTab('saisie')">Saisie donn√©es</button>
            <button class="tab" onclick="showTab('admin')">Administration</button>
        </div>

        <!-- Vue d'ensemble -->
        <div id="vue-ensemble" class="tab-content active">
            <div class="dashboard-grid">
                <div class="card">
                    <h3>üìä Performances du mois</h3>
                    <div class="metric">
                        <span>Prospects g√©n√©r√©s</span>
                        <span class="metric-value neutral" id="total-prospects">0</span>
                    </div>
                    <div class="metric">
                        <span>Devis envoy√©s</span>
                        <span class="metric-value neutral" id="total-devis">0</span>
                    </div>
                    <div class="metric">
                        <span>Ventes r√©alis√©es</span>
                        <span class="metric-value positive" id="total-ventes">0</span>
                    </div>
                    <div class="metric">
                        <span>Taux transformation global</span>
                        <span class="metric-value" id="taux-global">0%</span>
                    </div>
                </div>

                <div class="card">
                    <h3>üí∞ Chiffre d'affaires</h3>
                    <div class="metric">
                        <span>CA r√©alis√©</span>
                        <span class="metric-value positive" id="ca-realise">0 ‚Ç¨</span>
                    </div>
                    <div class="metric">
                        <span>Objectif mensuel √©quipe</span>
                        <span class="metric-value neutral" id="objectif-ca-total">0 ‚Ç¨</span>
                    </div>
                    <div class="metric">
                        <span>√âcart objectif</span>
                        <span class="metric-value" id="ecart-ca">0 ‚Ç¨</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="progress-ca" style="width: 0%"></div>
                    </div>
                </div>

                <div class="card">
                    <h3>üèÜ Top performer</h3>
                    <div class="metric">
                        <span>Meilleur vendeur</span>
                        <span class="metric-value positive" id="top-vendeur">-</span>
                    </div>
                    <div class="metric">
                        <span>Taux de transformation</span>
                        <span class="metric-value positive" id="top-taux">0%</span>
                    </div>
                    <div class="metric">
                        <span>CA g√©n√©r√©</span>
                        <span class="metric-value positive" id="top-ca">0 ‚Ç¨</span>
                    </div>
                    <div class="metric">
                        <span>Primes gagn√©es</span>
                        <span class="metric-value positive" id="top-primes">0 ‚Ç¨</span>
                    </div>
                </div>

                <div class="card">
                    <h3>üéØ Performance vs Objectifs</h3>
                    <div class="chart-container" id="chart-objectifs">
                        <!-- Chart will be generated by JS -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Vendeurs -->
        <div id="vendeurs" class="tab-content">
            <div class="dashboard-grid" id="vendeurs-grid">
                <!-- Vendeurs cards will be generated by JS -->
            </div>
        </div>

        <!-- Objectifs & Primes -->
        <div id="objectifs" class="tab-content">
            <div class="dashboard-grid" id="objectifs-grid">
                <!-- Objectifs cards will be generated by JS -->
            </div>
        </div>

        <!-- Pr√©dictions IA -->
        <div id="predictions" class="tab-content">
            <div class="dashboard-grid">
                <div class="card prediction-card">
                    <h3>ü§ñ Pr√©dictions IA <span class="ai-indicator">IA</span></h3>
                    <div class="metric">
                        <span>CA pr√©vu fin de mois</span>
                        <span class="metric-value" id="prediction-ca" style="color: white;">0 ‚Ç¨</span>
                    </div>
                    <div class="metric">
                        <span>Probabilit√© atteinte objectif</span>
                        <span class="metric-value" id="prediction-probabilite" style="color: white;">0%</span>
                    </div>
                    <div class="metric">
                        <span>Tendance g√©n√©rale</span>
                        <span class="metric-value" id="prediction-tendance" style="color: white;">-</span>
                    </div>
                </div>

                <div class="card">
                    <h3>üìà Recommandations IA</h3>
                    <div id="recommendations-ia">
                        <!-- Recommendations will be generated by JS -->
                    </div>
                </div>

                <div class="card">
                    <h3>üéØ Vendeur √† coacher prioritairement</h3>
                    <div class="metric">
                        <span>Vendeur identifi√©</span>
                        <span class="metric-value negative" id="vendeur-coaching">-</span>
                    </div>
                    <div class="metric">
                        <span>Raison principale</span>
                        <span class="metric-value neutral" id="raison-coaching">-</span>
                    </div>
                    <div class="metric">
                        <span>Action sugg√©r√©e</span>
                        <span class="metric-value neutral" id="action-coaching">-</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Tunnel conversion -->
        <div id="tunnel" class="tab-content">
            <div class="card">
                <h3>üîÑ Analyse du tunnel de conversion</h3>
                <div class="chart-container" id="tunnel-chart">
                    <!-- Tunnel chart will be generated by JS -->
                </div>
                <div class="alert alert-warning" id="tunnel-alert" style="display: none;">
                    <strong>‚ö†Ô∏è Point d'attention :</strong> <span id="tunnel-message"></span>
                </div>
            </div>
        </div>

        <!-- Saisie donn√©es -->
        <div id="saisie" class="tab-content">
            <div class="card">
                <h3>üìù Saisie des donn√©es commerciales</h3>
                
                <div class="input-group">
                    <div class="input-field">
                        <label>Vendeur</label>
                        <select id="vendeur-select">
                            <option value="Vincent">Vincent</option>
                            <option value="Raphael">Raphael</option>
                            <option value="L√©o">L√©o</option>
                            <option value="Pablo">Pablo</option>
                            <option value="Nathan">Nathan</option>
                        </select>
                    </div>
                    
                    <div class="input-field">
                        <label>Prospects re√ßus</label>
                        <input type="number" id="prospects-input" placeholder="Nombre de prospects" min="0">
                    </div>
                    
                    <div class="input-field">
                        <label>Devis envoy√©s</label>
                        <input type="number" id="devis-input" placeholder="Nombre de devis" min="0">
                    </div>
                    
                    <div class="input-field">
                        <label>Ventes finalis√©es</label>
                        <input type="number" id="ventes-input" placeholder="Nombre de ventes" min="0">
                    </div>
                    
                    <div class="input-field">
                        <label>CA g√©n√©r√© (‚Ç¨)</label>
                        <input type="number" id="ca-input" placeholder="Chiffre d'affaires" min="0">
                    </div>
                    
                    <div class="input-field">
                        <label>Type majoritaire</label>
                        <select id="type-poele">
                            <option value="Bois">Po√™le √† bois</option>
                            <option value="Granul√©s">Po√™le √† granul√©s</option>
                            <option value="Mixte">Mixte bois/granul√©s</option>
                        </select>
                    </div>
                </div>
                
                <button class="btn" onclick="ajouterDonnees()">üíæ Enregistrer les donn√©es</button>
                
                <div id="success-message" class="alert alert-success" style="display: none;">
                    ‚úÖ Donn√©es enregistr√©es avec succ√®s !
                </div>
            </div>
        </div>

        <!-- Administration -->
        <div id="admin" class="tab-content">
            <div class="dashboard-grid">
                <div class="card">
                    <h3>‚öôÔ∏è Configuration des objectifs mensuels</h3>
                    
                    <div class="input-group">
                        <div class="input-field">
                            <label>Vendeur</label>
                            <select id="admin-vendeur-select">
                                <option value="Vincent">Vincent</option>
                                <option value="Raphael">Raphael</option>
                                <option value="L√©o">L√©o</option>
                                <option value="Pablo">Pablo</option>
                                <option value="Nathan">Nathan</option>
                            </select>
                        </div>
                        
                        <div class="input-field">
                            <label>Mois</label>
                            <select id="admin-mois-select">
                                <option value="Septembre 2025">Septembre 2025</option>
                                <option value="Octobre 2025">Octobre 2025</option>
                                <option value="Novembre 2025">Novembre 2025</option>
                                <option value="D√©cembre 2025">D√©cembre 2025</option>
                            </select>
                        </div>
                        
                        <div class="input-field">
                            <label>Objectif CA (‚Ç¨)</label>
                            <input type="number" id="admin-objectif-input" placeholder="Ex: 100000" min="0">
                        </div>
                    </div>
                    
                    <button class="btn" onclick="definirObjectif()">üéØ D√©finir l'objectif</button>
                </div>

                <div class="card">
                    <h3>üí∞ Configuration des paliers de primes</h3>
                    
                    <div class="input-group">
                        <div class="input-field">
                            <label>Seuil CA (‚Ç¨)</label>
                            <input type="number" id="admin-seuil-input" placeholder="Ex: 110000" min="0">
                        </div>
                        
                        <div class="input-field">
                            <label>Prime (‚Ç¨)</label>
                            <input type="number" id="admin-prime-input" placeholder="Ex: 500" min="0">
                        </div>
                    </div>
                    
                    <button class="btn" onclick="ajouterPalier()">üíé Ajouter un palier</button>
                    <button class="btn btn-danger" onclick="reinitialiserPaliers()">üóëÔ∏è R√©initialiser</button>
                    
                    <div id="paliers-preview" class="paliers-container" style="display: none;">
                        <h4>Paliers actuels :</h4>
                        <div id="paliers-list"></div>
                    </div>
                </div>

                <div class="card">
                    <h3>üìä Actions globales</h3>
                    <button class="btn" onclick="exporterDonnees()">üì• Exporter les donn√©es</button>
                    <button class="btn btn-danger" onclick="reinitialiserDonnees()">üîÑ R√©initialiser toutes les donn√©es</button>
                    
                    <div class="alert alert-info">
                        <strong>‚ÑπÔ∏è Info :</strong> Les donn√©es sont stock√©es localement dans votre navigateur. Pour sauvegarder d√©finitivement, utilisez l'export.
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Donn√©es des vendeurs avec vrais noms
        let vendeursData = {
            'Vincent': { prospects: 15, devis: 8, ventes: 3, ca: 32000, type: 'Bois', objectif: 80000 },
            'Raphael': { prospects: 12, devis: 9, ventes: 5, ca: 78000, type: 'Granul√©s', objectif: 100000 },
            'L√©o': { prospects: 18, devis: 6, ventes: 2, ca: 28000, type: 'Bois', objectif: 75000 },
            'Pablo': { prospects: 20, devis: 12, ventes: 6, ca: 82000, type: 'Granul√©s', objectif: 90000 },
            'Nathan': { prospects: 10, devis: 7, ventes: 4, ca: 65000, type: 'Mixte', objectif: 85000 }
        };

        // Configuration des paliers de primes (global pour tous les vendeurs pour l'exemple)
        let paliersGlobaux = [
            { seuil: 0, prime: 0 },
            { seuil: 80000, prime: 200 },
            { seuil: 90000, prime: 350 },
            { seuil: 100000, prime: 500 },
            { seuil: 110000, prime: 750 }
        ];

        function showTab(tabName) {
            // Cacher tous les contenus
            const contents = document.querySelectorAll('.tab-content');
            contents.forEach(content => content.classList.remove('active'));
            
            // D√©sactiver tous les tabs
            const tabs = document.querySelectorAll('.tab');
            tabs.forEach(tab => tab.classList.remove('active'));
            
            // Activer le tab et contenu s√©lectionn√©s
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');
            
            // Mettre √† jour les donn√©es selon le tab
            if (tabName === 'vue-ensemble') {
                updateVueEnsemble();
            } else if (tabName === 'vendeurs') {
                updateVendeurs();
            } else if (tabName === 'objectifs') {
                updateObjectifs();
            } else if (tabName === 'predictions') {
                updatePredictions();
            } else if (tabName === 'tunnel') {
                updateTunnel();
            }
        }

        function calculerPrime(ca) {
            let primeTotal = 0;
            for (let i = paliersGlobaux.length - 1; i >= 0; i--) {
                if (ca >= paliersGlobaux[i].seuil) {
                    primeTotal = paliersGlobaux[i].prime;
                    break;
                }
            }
            return primeTotal;
        }

        function updateVueEnsemble() {
            let totalProspects = 0, totalDevis = 0, totalVentes = 0, totalCA = 0, totalObjectif = 0;
            let bestVendeur = '', bestTaux = 0, bestCA = 0, bestPrimes = 0;

            for (let vendeur in vendeursData) {
                const data = vendeursData[vendeur];
                totalProspects += data.prospects;
                totalDevis += data.devis;
                totalVentes += data.ventes;
                totalCA += data.ca;
                totalObjectif += data.objectif;

                const taux = data.prospects > 0 ? (data.ventes / data.prospects * 100) : 0;
                const primes = calculerPrime(data.ca);
                
                if (taux > bestTaux) {
                    bestTaux = taux;
                    bestVendeur = vendeur;
                    bestCA = data.ca;
                    bestPrimes = primes;
                }
            }

            const tauxGlobal = totalProspects > 0 ? (totalVentes / totalProspects * 100) : 0;
            const ecartCA = totalCA - totalObjectif;
            const progressCA = Math.min(100, (totalCA / totalObjectif) * 100);

            document.getElementById('total-prospects').textContent = totalProspects;
            document.getElementById('total-devis').textContent = totalDevis;
            document.getElementById('total-ventes').textContent = totalVentes;
            document.getElementById('taux-global').textContent = tauxGlobal.toFixed(1) + '%';
            document.getElementById('taux-global').className = 'metric-value ' + (tauxGlobal >= 20 ? 'positive' : tauxGlobal >= 15 ? 'neutral' : 'negative');

            document.getElementById('ca-realise').textContent = totalCA.toLocaleString() + ' ‚Ç¨';
            document.getElementById('objectif-ca-total').textContent = totalObjectif.toLocaleString() + ' ‚Ç¨';
            document.getElementById('ecart-ca').textContent = (ecartCA >= 0 ? '+' : '') + ecartCA.toLocaleString() + ' ‚Ç¨';
            document.getElementById('ecart-ca').className = 'metric-value ' + (ecartCA >= 0 ? 'positive' : 'negative');
            document.getElementById('progress-ca').style.width = progressCA + '%';

            document.getElementById('top-vendeur').textContent = bestVendeur;
            document.getElementById('top-taux').textContent = bestTaux.toFixed(1) + '%';
            document.getElementById('top-ca').textContent = bestCA.toLocaleString() + ' ‚Ç¨';
            document.getElementById('top-primes').textContent = bestPrimes.toLocaleString() + ' ‚Ç¨';

            // Mise √† jour du graphique objectifs
            updateChart();
        }

        function updateVendeurs() {
            const grid = document.getElementById('vendeurs-grid');
            grid.innerHTML = '';

            for (let vendeur in vendeursData) {
                const data = vendeursData[vendeur];
                const taux = data.prospects > 0 ? (data.ventes / data.prospects * 100) : 0;
                const tauxDevis = data.devis > 0 ? (data.ventes / data.devis * 100) : 0;
                const progressObjectif = (data.ca / data.objectif) * 100;
                const primes = calculerPrime(data.ca);

                const card = document.createElement('div');
                card.className = 'card vendeur-card';
                card.innerHTML = `
                    <h3>üë§ ${vendeur}</h3>
                    <div class="metric">
                        <span>Prospects trait√©s</span>
                        <span class="metric-value neutral">${data.prospects}</span>
                    </div>
                    <div class="metric">
                        <span>Devis envoy√©s</span>
                        <span class="metric-value neutral">${data.devis}</span>
                    </div>
                    <div class="metric">
                        <span>Ventes r√©alis√©es</span>
                        <span class="metric-value positive">${data.ventes}</span>
                    </div>
                    <div class="metric">
                        <span>Taux transformation</span>
                        <span class="metric-value ${taux >= 25 ? 'positive' : taux >= 20 ? 'neutral' : 'negative'}">${taux.toFixed(1)}%</span>
                    </div>
                    <div class="metric">
                        <span>Taux devis ‚Üí vente</span>
                        <span class="metric-value ${tauxDevis >= 60 ? 'positive' : tauxDevis >= 45 ? 'neutral' : 'negative'}">${tauxDevis.toFixed(1)}%</span>
                    </div>
                    <div class="metric">
                        <span>CA g√©n√©r√©</span>
                        <span class="metric-value positive">${data.ca.toLocaleString()} ‚Ç¨</span>
                    </div>
                    <div class="metric">
                        <span>Objectif mensuel</span>
                        <span class="metric-value neutral">${data.objectif.toLocaleString()} ‚Ç¨</span>
                    </div>
                    <div class="metric">
                        <span>Progression objectif</span>
                        <span class="metric-value ${progressObjectif >= 100 ? 'positive' : progressObjectif >= 80 ? 'neutral' : 'negative'}">${progressObjectif.toFixed(1)}%</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: ${Math.min(100, progressObjectif)}%"></div>
                    </div>
                    <div class="metric">
                        <span>Primes gagn√©es</span>
                        <span class="metric-value positive">${primes.toLocaleString()} ‚Ç¨</span>
                    </div>
                    <div class="metric">
                        <span>Type principal</span>
                        <span class="metric-value neutral">${data.type}</span>
                    </div>
                `;
                grid.appendChild(card);
            }
        }

        function updateObjectifs() {
            const grid = document.getElementById('objectifs-grid');
            grid.innerHTML = '';

            for (let vendeur in vendeursData) {
                const data = vendeursData[vendeur];
                const progressObjectif = (data.ca / data.objectif) * 100;
                const primes = calculerPrime(data.ca);
                
                const card = document.createElement('div');
                card.className = 'card';
                card.innerHTML = `
                    <h3>üéØ ${vendeur}</h3>
                    <div class="metric">
                        <span>Objectif mensuel</span>
                        <span class="metric-value neutral">${data.objectif.toLocaleString()} ‚Ç¨</span>
                    </div>
                    <div class="metric">
                        <span>CA actuel</span>
                        <span class="metric-value ${data.ca >= data.objectif ? 'positive' : 'neutral'}">${data.ca.toLocaleString()} ‚Ç¨</span>
                    </div>
                    <div class="metric">
                        <span>Progression</span>
                        <span class="metric-value ${progressObjectif >= 100 ? 'positive' : progressObjectif >= 80 ? 'neutral' : 'negative'}">${progressObjectif.toFixed(1)}%</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: ${Math.min(100, progressObjectif)}%"></div>
                    </div>
                    <div class="metric">
                        <span>Primes actuelles</span>
                        <span class="metric-value positive">${primes.toLocaleString()} ‚Ç¨</span>
                    </div>
                    <div class="paliers-container">
                        <h4>Paliers de primes :</h4>
                        ${generatePaliersHTML(data.ca)}
                    </div>
                `;
                grid.appendChild(card);
            }
        }

        function generatePaliersHTML(caActuel) {
            let html = '';
            paliersGlobaux.forEach(palier => {
                const isAtteint = caActuel >= palier.seuil;
                const statusIcon = isAtteint ? '‚úÖ' : '‚è≥';
                html += `
                    <div class="palier-item" style="${isAtteint ? 'background: rgba(72, 187, 120, 0.1);' : ''}">
                        <span>${statusIcon} ${palier.seuil.toLocaleString()} ‚Ç¨ et +</span>
                        <span class="prime-badge" style="${isAtteint ? 'background: #48bb78;' : 'background: #cbd5e0; color: #4a5568;'}">${palier.prime} ‚Ç¨</span>
                    </div>
                `;
            });
            return html;
        }

        function updatePredictions() {
            // Calculs pr√©dictifs bas√©s sur les donn√©es actuelles
            let totalCA = 0;
            let totalObjectif = 0;
            let tendances = [];

            for (let vendeur in vendeursData) {
                const data = vendeursData[vendeur];
                totalCA += data.ca;
                totalObjectif += data.objectif;
                
                // Calcul tendance individuelle
                const progressJour = data.ca / 20; // Simulation : on est au 20e jour du mois
                const projectionFinMois = progressJour * 30;
                tendances.push({
                    vendeur: vendeur,
                    projection: projectionFinMois,
                    objectif: data.objectif,
                    performance: projectionFinMois / data.objectif
                });
            }

            // Pr√©diction globale
            const progressMoyen = totalCA / totalObjectif;
            const projectionGlobale = (totalCA / 20) * 30; // Simulation
            const probabiliteSucces = Math.min(95, progressMoyen * 100);

            document.getElementById('prediction-ca').textContent = Math.round(projectionGlobale).toLocaleString() + ' ‚Ç¨';
            document.getElementById('prediction-probabilite').textContent = Math.round(probabiliteSucces) + '%';
            
            const tendanceText = probabiliteSucces >= 80 ? 'üìà Excellente' : 
                               probabiliteSucces >= 60 ? 'üìä Bonne' : 'üìâ √Ä surveiller';
            document.getElementById('prediction-tendance').textContent = tendanceText;

            // Recommandations IA
            updateRecommendationsIA(tendances);

            // Identification du vendeur √† coacher
            const vendeurEnDifficulte = tendances.reduce((min, vendeur) => 
                vendeur.performance < min.performance ? vendeur : min
            );

            document.getElementById('vendeur-coaching').textContent = vendeurEnDifficulte.vendeur;
            
            if (vendeurEnDifficulte.performance < 0.7) {
                document.getElementById('raison-coaching').textContent = 'Performance < 70% objectif';
                document.getElementById('action-coaching').textContent = 'Accompagnement terrain urgent';
            } else if (vendeurEnDifficulte.performance < 0.9) {
                document.getElementById('raison-coaching').textContent = 'Risque de non-atteinte objectif';
                document.getElementById('action-coaching').textContent = 'Coaching closing & suivi prospects';
            } else {
                document.getElementById('raison-coaching').textContent = 'Optimisation performance';
                document.getElementById('action-coaching').textContent = 'Partage bonnes pratiques √©quipe';
            }
        }

        function updateRecommendationsIA(tendances) {
            const container = document.getElementById('recommendations-ia');
            let recommendations = [];

            // Analyse des tendances pour g√©n√©rer des recommandations
            const performancesMoyennes = tendances.reduce((acc, v) => acc + v.performance, 0) / tendances.length;
            
            if (performancesMoyennes < 0.8) {
                recommendations.push('üéØ Organiser une session de coaching collectif sur les techniques de closing');
                recommendations.push('üìû Intensifier le suivi des devis en cours');
            }
            
            const vendeurTop = tendances.reduce((max, v) => v.performance > max.performance ? v : max);
            if (vendeurTop.performance > 1.2) {
                recommendations.push(`üåü Demander √† ${vendeurTop.vendeur} de partager ses bonnes pratiques en √©quipe`);
            }

            const vendeursEnRetard = tendances.filter(v => v.performance < 0.7).length;
            if (vendeursEnRetard > 1) {
                recommendations.push('‚ö†Ô∏è Revoir les objectifs individuels - plusieurs vendeurs en difficult√©');
            }

            recommendations.push('üí° Focus sur la qualification prospects pour am√©liorer taux transformation');
            recommendations.push('üìà Augmenter fr√©quence relance devis (J+3, J+7, J+14)');

            container.innerHTML = recommendations.map(rec => `
                <div class="alert alert-info" style="margin: 8px 0; padding: 12px;">
                    ${rec}
                </div>
            `).join('');
        }

        function updateTunnel() {
            let totalProspects = 0, totalDevis = 0, totalVentes = 0;
            
            for (let vendeur in vendeursData) {
                const data = vendeursData[vendeur];
                totalProspects += data.prospects;
                totalDevis += data.devis;
                totalVentes += data.ventes;
            }

            const tauxProspectDevis = totalProspects > 0 ? (totalDevis / totalProspects * 100) : 0;
            const tauxDevisVente = totalDevis > 0 ? (totalVentes / totalDevis * 100) : 0;
            const tauxGlobal = totalProspects > 0 ? (totalVentes / totalProspects * 100) : 0;

            const chart = document.getElementById('tunnel-chart');
            chart.innerHTML = `
                <div class="bar-group">
                    <div class="bar" style="height: ${Math.max(20, Math.min(250, totalProspects * 3))}px; background: linear-gradient(to top, #4299e1, #3182ce);">
                        <div class="bar-value">${totalProspects}</div>
                    </div>
                    <div class="bar-label">Prospects</div>
                </div>
                <div style="display: flex; align-items: center; margin: 0 10px;">
                    <div style="color: #4a5568; font-weight: bold; font-size: 0.9em;">${tauxProspectDevis.toFixed(1)}%</div>
                    <div style="width: 30px; height: 2px; background: #cbd5e0; margin: 0 5px;"></div>
                    <div style="font-size: 1.5em;">‚û°Ô∏è</div>
                </div>
                <div class="bar-group">
                    <div class="bar" style="height: ${Math.max(20, Math.min(250, totalDevis * 5))}px; background: linear-gradient(to top, #ed8936, #dd6b20);">
                        <div class="bar-value">${totalDevis}</div>
                    </div>
                    <div class="bar-label">Devis</div>
                </div>
                <div style="display: flex; align-items: center; margin: 0 10px;">
                    <div style="color: #4a5568; font-weight: bold; font-size: 0.9em;">${tauxDevisVente.toFixed(1)}%</div>
                    <div style="width: 30px; height: 2px; background: #cbd5e0; margin: 0 5px;"></div>
                    <div style="font-size: 1.5em;">‚û°Ô∏è</div>
                </div>
                <div class="bar-group">
                    <div class="bar" style="height: ${Math.max(20, Math.min(250, totalVentes * 8))}px; background: linear-gradient(to top, #48bb78, #38a169);">
                        <div class="bar-value">${totalVentes}</div>
                    </div>
                    <div class="bar-label">Ventes</div>
                </div>
            `;

            // Analyse et alerte
            const alert = document.getElementById('tunnel-alert');
            const message = document.getElementById('tunnel-message');
            
            if (tauxProspectDevis < 50) {
                alert.style.display = 'block';
                message.textContent = `Taux prospect‚Üídevis faible (${tauxProspectDevis.toFixed(1)}%). Focus sur la qualit√© de la d√©couverte client.`;
            } else if (tauxDevisVente < 45) {
                alert.style.display = 'block';
                message.textContent = `Taux devis‚Üívente faible (${tauxDevisVente.toFixed(1)}%). Focus sur la conclusion et le suivi commercial.`;
            } else {
                alert.style.display = 'none';
            }
        }

        function updateChart() {
            const chart = document.getElementById('chart-objectifs');
            const vendeurs = Object.keys(vendeursData);

            let chartHTML = '<div style="display: flex; align-items: end; height: 100%; justify-content: space-around; overflow-x: auto; min-width: 100%;">';
            vendeurs.forEach(vendeur => {
                const data = vendeursData[vendeur];
                const maxHeight = 200;
                const maxObjectif = Math.max(...Object.values(vendeursData).map(v => v.objectif));
                
                const heightObjectif = Math.max(20, (data.objectif / maxObjectif) * maxHeight);
                const heightCA = Math.max(20, (data.ca / maxObjectif) * maxHeight);
                
                const colorCA = data.ca >= data.objectif ? '#48bb78' : 
                              data.ca >= data.objectif * 0.8 ? '#ed8936' : '#e53e3e';
                
                chartHTML += `
                    <div class="bar-group">
                        <div style="display: flex; align-items: end;">
                            <div class="bar" style="height: ${heightObjectif}px; background: #cbd5e0; width: 25px; margin-right: 5px;">
                                <div class="bar-value" style="color: #4a5568;">${(data.objectif/1000).toFixed(0)}k‚Ç¨</div>
                            </div>
                            <div class="bar" style="height: ${heightCA}px; background: ${colorCA}; width: 25px;">
                                <div class="bar-value">${(data.ca/1000).toFixed(0)}k‚Ç¨</div>
                            </div>
                        </div>
                        <div class="bar-label">${vendeur}</div>
                    </div>
                `;
            });
            chartHTML += '</div>';
            chart.innerHTML = chartHTML;
        }

        // Fonctions d'administration
        function definirObjectif() {
            const vendeur = document.getElementById('admin-vendeur-select').value;
            const objectif = parseInt(document.getElementById('admin-objectif-input').value) || 0;
            
            if (objectif > 0) {
                vendeursData[vendeur].objectif = objectif;
                document.getElementById('admin-objectif-input').value = '';
                
                showSuccessMessage('Objectif d√©fini avec succ√®s pour ' + vendeur + ' !');
                updateVueEnsemble();
            }
        }

        function ajouterPalier() {
            const seuil = parseInt(document.getElementById('admin-seuil-input').value) || 0;
            const prime = parseInt(document.getElementById('admin-prime-input').value) || 0;
            
            if (seuil > 0 && prime >= 0) {
                // Ajouter ou mettre √† jour le palier
                const existingIndex = paliersGlobaux.findIndex(p => p.seuil === seuil);
                if (existingIndex >= 0) {
                    paliersGlobaux[existingIndex].prime = prime;
                } else {
                    paliersGlobaux.push({ seuil: seuil, prime: prime });
                }
                
                // Trier les paliers par seuil
                paliersGlobaux.sort((a, b) => a.seuil - b.seuil);
                
                document.getElementById('admin-seuil-input').value = '';
                document.getElementById('admin-prime-input').value = '';
                
                showPaliersPreview();
                showSuccessMessage('Palier ajout√© avec succ√®s !');
            }
        }

        function showPaliersPreview() {
            const container = document.getElementById('paliers-preview');
            const list = document.getElementById('paliers-list');
            
            list.innerHTML = paliersGlobaux.map(palier => `
                <div class="palier-item">
                    <span>${palier.seuil.toLocaleString()} ‚Ç¨ et +</span>
                    <span class="prime-badge">${palier.prime} ‚Ç¨</span>
                </div>
            `).join('');
            
            container.style.display = 'block';
        }

        function reinitialiserPaliers() {
            if (confirm('√ätes-vous s√ªr de vouloir r√©initialiser tous les paliers de primes ?')) {
                paliersGlobaux = [
                    { seuil: 0, prime: 0 },
                    { seuil: 80000, prime: 200 },
                    { seuil: 90000, prime: 350 },
                    { seuil: 100000, prime: 500 },
                    { seuil: 110000, prime: 750 }
                ];
                showPaliersPreview();
                showSuccessMessage('Paliers r√©initialis√©s !');
            }
        }

        function ajouterDonnees() {
            const vendeur = document.getElementById('vendeur-select').value;
            const prospects = parseInt(document.getElementById('prospects-input').value) || 0;
            const devis = parseInt(document.getElementById('devis-input').value) || 0;
            const ventes = parseInt(document.getElementById('ventes-input').value) || 0;
            const ca = parseInt(document.getElementById('ca-input').value) || 0;
            const type = document.getElementById('type-poele').value;

            // Mise √† jour des donn√©es (additive)
            vendeursData[vendeur].prospects += prospects;
            vendeursData[vendeur].devis += devis;
            vendeursData[vendeur].ventes += ventes;
            vendeursData[vendeur].ca += ca;
            if (type !== vendeursData[vendeur].type) {
                vendeursData[vendeur].type = type;
            }

            // R√©initialiser les champs
            document.getElementById('prospects-input').value = '';
            document.getElementById('devis-input').value = '';
            document.getElementById('ventes-input').value = '';
            document.getElementById('ca-input').value = '';

            showSuccessMessage('Donn√©es enregistr√©es avec succ√®s !');
            updateVueEnsemble();
        }

        function showSuccessMessage(message) {
            const successMsg = document.getElementById('success-message');
            successMsg.textContent = '‚úÖ ' + message;
            successMsg.style.display = 'block';
            setTimeout(() => {
                successMsg.style.display = 'none';
            }, 3000);
        }

        function exporterDonnees() {
            const dataToExport = {
                vendeurs: vendeursData,
                paliers: paliersGlobaux,
                dateExport: new Date().toISOString()
            };
            
            const blob = new Blob([JSON.stringify(dataToExport, null, 2)], {type: 'application/json'});
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'dashboard-commercial-' + new Date().toISOString().split('T')[0] + '.json';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showSuccessMessage('Donn√©es export√©es avec succ√®s !');
        }

        function reinitialiserDonnees() {
            if (confirm('‚ö†Ô∏è ATTENTION : Cette action va supprimer toutes les donn√©es des vendeurs. √ätes-vous s√ªr ?')) {
                vendeursData = {
                    'Vincent': { prospects: 0, devis: 0, ventes: 0, ca: 0, type: 'Bois', objectif: 80000 },
                    'Raphael': { prospects: 0, devis: 0, ventes: 0, ca: 0, type: 'Granul√©s', objectif: 100000 },
                    'L√©o': { prospects: 0, devis: 0, ventes: 0, ca: 0, type: 'Bois', objectif: 75000 },
                    'Pablo': { prospects: 0, devis: 0, ventes: 0, ca: 0, type: 'Granul√©s', objectif: 90000 },
                    'Nathan': { prospects: 0, devis: 0, ventes: 0, ca: 0, type: 'Mixte', objectif: 85000 }
                };
                updateVueEnsemble();
                showSuccessMessage('Toutes les donn√©es ont √©t√© r√©initialis√©es !');
            }
        }

        // Initialisation au chargement
        document.addEventListener('DOMContentLoaded', function() {
            updateVueEnsemble();
            showPaliersPreview();
        });
    </script>
</body>
</html>
